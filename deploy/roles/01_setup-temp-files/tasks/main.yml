- name: Removing previous setup files (in case of failure last run)
  command: rm -R {{ temp_path }}
  ignore_errors: true
  sudo: true

- name: Creating setup files directory
  file: path="{{ temp_path }}"
        state=directory
        owner=monitor
        group=rpi-group
        mode=0777
        recurse=yes
  sudo: true

- name: Copying base files
  copy: src="{{ files_base }}/"
        dest="{{ temp_path }}"
        mode=0775
  sudo: true

- name: Copying override base files
  copy: src="{{ files_override }}/{{ override_base }}/"
        dest="{{ temp_path }}"
        mode=0775
  when: files_override is defined and override_base is defined
  sudo: true

- name: Copying override files
  copy: src="{{ files_override }}/{{ inventory_hostname }}/"
        dest="{{ temp_path }}"
        mode=0775
  when: files_override is defined and hostname_override is not defined
  sudo: true

- name: Copying override files (hostname override)
  copy: src="{{ files_override }}/{{ hostname_override }}/"
        dest="{{ temp_path }}"
        mode=0775
  when: files_override is defined and hostname_override is defined
  sudo: true

- name: Setting permissions on setup files...
  shell: chmod -R 775 "{{ temp_path }}"
  sudo: true
